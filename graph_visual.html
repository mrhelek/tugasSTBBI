<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisasi Rekomendasi Graf - Smart Travel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body class="bg-gray-100 font-sans text-gray-800">

    <div class="bg-red-700 text-white p-4 shadow-lg">
        <div class="container mx-auto flex items-center justify-between">
            <h1 class="text-2xl font-bold"><i class="fas fa-project-diagram mr-2"></i> Visualisasi Graf AI</h1>
            <a href="/" class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg transition text-sm font-bold">
                <i class="fas fa-arrow-left mr-1"></i> Kembali ke Dashboard
            </a>
        </div>
    </div>

    <div class="container mx-auto p-6 max-w-4xl">
        <div class="bg-white p-8 rounded-2xl shadow-xl mb-8">
            <h2 class="text-3xl font-extrabold text-gray-800 mb-2">Mengapa {{ data.target.name }} Direkomendasikan?</h2>
            <p class="text-gray-600 mb-6">Diagram di bawah ini menunjukkan bagaimana algoritma graf menghubungkan preferensi Anda dengan tempat ini.</p>
            
            <div class="bg-gray-50 p-6 rounded-xl border-2 border-red-100 flex justify-center overflow-auto">
                <div class="mermaid">
                    graph TD
                        %% Node Definitions dengan tanda kutip agar aman
                        User["ðŸ‘¤ User / Preferensi"]
                        Cat["ðŸ“‚ Kategori: {{ data.category }}"]
                        Target["{{ data.target.name }}"]
                        
                        %% Conditional Node for Anchor
                        {% if data.anchor %}
                        Anchor["{{ data.anchor.name }}"]
                        {% endif %}

                        %% Styling Nodes
                        style User fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#1565c0
                        style Cat fill:#fff3e0,stroke:#e65100,stroke-width:2px,color:#e65100
                        style Target fill:#ffebee,stroke:#c62828,stroke-width:4px,color:#c62828,font-weight:bold

                        {% if data.anchor %}
                        style Anchor fill:#f3e5f5,stroke:#6a1b9a,stroke-width:2px,color:#6a1b9a,stroke-dasharray: 5 5
                        {% endif %}

                        %% Edges (Hubungan)
                        User -- "Meminati" --> Cat
                        Cat -- "Termasuk" --> Target
                        
                        {% if data.anchor %}
                        Cat -- "Termasuk (Populer)" --> Anchor
                        Anchor <==>|Keterhubungan Kuat <br/>(Kategori Sama)| Target
                        {% endif %}
                </div>
            </div>

            <div class="mt-8 p-4 bg-blue-50 rounded-lg border-l-4 border-blue-500 text-sm text-blue-800">
                <h3 class="font-bold mb-1"><i class="fas fa-info-circle mr-1"></i> Penjelasan Graf:</h3>
                <ul class="list-disc list-inside space-y-1 ml-2">
                    <li><b>User Node (Biru):</b> Mewakili preferensi kategori yang Anda pilih.</li>
                    <li><b>Kategori Node (Oranye):</b> Kategori wisata yang menghubungkan tempat-tempat tersebut.</li>
                    {% if data.anchor %}
                    <li><b>{{ data.anchor.name }} (Ungu):</b> Tempat yang sangat populer di kategori ini, digunakan sebagai "jangkar" atau referensi.</li>
                    {% endif %}
                    <li><b>{{ data.target.name }} (Merah Tebal):</b> Tempat yang direkomendasikan untuk Anda.</li>
                </ul>
                <p class="mt-2">
                    {% if data.anchor %}
                    Sistem merekomendasikan tempat ini karena memiliki hubungan kategori yang kuat dengan tempat populer lain (<b>{{ data.anchor.name }}</b>), namun mungkin belum pernah Anda kunjungi.
                    {% else %}
                    Sistem merekomendasikan tempat ini karena merupakan pilihan terbaik yang tersedia dalam kategori yang Anda minati di kota ini.
                    {% endif %}
                </p>
            </div>

        </div>

        <div class="bg-white rounded-2xl shadow-xl overflow-hidden flex flex-col md:flex-row">
            <div class="md:w-1/3 h-48 md:h-auto relative">
                 <img src="{{ data.target.image_url }}" alt="{{ data.target.name }}" class="w-full h-full object-cover">
            </div>
            <div class="p-6 md:w-2/3">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">{{ data.target.name }}</h3>
                 <div class="text-sm text-gray-600 space-y-2 mb-4 flex-grow">
                    <p class="flex items-center font-medium"><i class="fas fa-map-marker-alt w-6 text-center text-red-500 mr-2"></i> {{ data.target.city }}</p>
                    <p class="flex items-center font-medium"><i class="fas fa-tag w-6 text-center text-red-500 mr-2"></i> {{ data.target.price == 0 and 'Gratis' or 'Rp ' + '{:,.0f}'.format(data.target.price) }}</p>
                    <p class="flex items-center font-medium"><i class="fas fa-star w-6 text-center text-yellow-500 mr-2"></i> {{ data.target.rating }} / 5.0</p>
                </div>
                <div class="mt-4">
                    <div class="flex justify-between text-xs mb-1 font-semibold">
                        <span>Skor Sentimen Ulasan</span>
                        <span class="{{ data.target.sentiment_avg >= 0.6 and 'text-green-600' or (data.target.sentiment_avg <= 0.4 and 'text-red-600' or 'text-gray-600') }}">
                            {{ '{:.0f}'.format(data.target.sentiment_avg * 100) }}% Positif
                        </span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="{{ data.target.sentiment_avg >= 0.6 and 'bg-green-500' or (data.target.sentiment_avg <= 0.4 and 'bg-red-500' or 'bg-yellow-500') }} h-2.5 rounded-full" style="width: {{ data.target.sentiment_avg * 100 }}%"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</body>
</html>